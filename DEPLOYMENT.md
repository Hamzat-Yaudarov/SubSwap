# ðŸš€ Deployment Guide for Wormz Bot

This guide covers how to deploy the Wormz Bot + MiniApp to Railway.

## Prerequisites

- GitHub account with the repository
- Railway account (railway.app)
- Neon PostgreSQL account (optional, Railway provides PostgreSQL)
- Telegram Bot Token (from @BotFather)

## Step 1: Prepare the Repository

1. Make sure all code is committed:
   ```bash
   git add .
   git commit -m "Initial commit: Wormz Bot + MiniApp"
   ```

2. Push to GitHub:
   ```bash
   git push origin main
   ```

## Step 2: Create Railway Project

1. Go to [railway.app](https://railway.app)
2. Click "New Project"
3. Select "Deploy from GitHub"
4. Connect your GitHub account and select the wormzrobot-miniapp repository
5. Click "Deploy"

Railway will automatically start building and deploying.

## Step 3: Set Environment Variables

In the Railway dashboard:

1. Go to your project
2. Click on the service (your app)
3. Click "Variables"
4. Add the following environment variables:

```
BOT_TOKEN=8520227063:AAFw0Tmc7bnm9qE0Cgl68dXYMqpic1J517o
BOT_USERNAME=wormzrobot
NODE_ENV=production
PORT=8080
```

## Step 4: Add PostgreSQL Database

1. In your Railway project, click "New Service"
2. Select "Database"
3. Choose "PostgreSQL"
4. Railway will automatically create a `DATABASE_URL` environment variable

This takes ~1 minute. Your database is now ready.

## Step 5: Get Your App URL

1. In the Railway dashboard, click on your service
2. Look for "Domains"
3. Copy your app's domain (e.g., `https://wormzrobot-production-1234.up.railway.app`)

## Step 6: Update WEBAPP_URL

1. Go to Variables
2. Add or update `WEBAPP_URL` with your Railway domain:
   ```
   WEBAPP_URL=https://wormzrobot-production-1234.up.railway.app
   ```

## Step 7: Verify Deployment

1. Click "View Logs" to see your app starting
2. Wait until you see: `âœ… Database schema initialized`
3. Wait until you see: `ðŸš€ Server running on port 8080`

Your app is now live!

## Step 8: Test the Bot

1. Open Telegram
2. Search for `@wormzrobot`
3. Click "Start"
4. You should see the welcome message
5. Click "ðŸ“± ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ MiniApp"
6. The MiniApp should load in Telegram

## Step 9: Test the MiniApp

In the MiniApp:
1. Go to "ÐœÐ¾Ð¸ ÐºÐ°Ð½Ð°Ð»Ñ‹" (My Channels)
2. Try adding a test channel
3. Go to "Ð’Ð·Ð°Ð¸Ð¼ÐºÐ¸" (Mutuals)
4. Verify data loads correctly

## Troubleshooting

### Database Connection Error
- Check that PostgreSQL service is running in Railway
- Verify DATABASE_URL is set correctly
- Check database logs for errors

### Bot Not Responding
- Verify BOT_TOKEN is correct (starts with numbers)
- Check bot logs: `View Logs` in Railway dashboard
- Make sure node_modules are installed

### MiniApp Not Loading
- Check WEBAPP_URL is set to your Railway domain
- Verify frontend files are in `public/` directory
- Check browser console for errors (F12 in Telegram Desktop)

### Schema Not Initializing
- Check database connection
- Verify PostgreSQL service is healthy
- Look for SQL syntax errors in `db/schema.sql`

## Scaling in Production

### Load Balancing
Railway automatically handles load balancing. You can add more replicas:
1. Click your service
2. Click "Deploy"
3. Set "Replicas" > 1

### Database Backups
- Neon (recommended): Use Neon dashboard for automated backups
- Railway PostgreSQL: Use Railway's backup features

### Monitoring
Railway provides built-in monitoring:
- CPU usage
- Memory usage
- Network traffic
- Error rates

## Environment Variables Checklist

Before deploying, ensure these are set:

- [ ] `BOT_TOKEN` - From @BotFather
- [ ] `BOT_USERNAME` - Your bot's username (without @)
- [ ] `WEBAPP_URL` - Your Railway domain
- [ ] `DATABASE_URL` - Auto-generated by Railway
- [ ] `NODE_ENV=production`
- [ ] `PORT=8080`

## Updating the App

To deploy new changes:

1. Make changes locally
2. Commit and push to GitHub:
   ```bash
   git add .
   git commit -m "Update: your changes"
   git push origin main
   ```
3. Railway automatically redeploys (watch "Deployments" tab)

## Rollback

If something goes wrong:

1. Go to "Deployments" tab
2. Find the previous good deployment
3. Click "Redeploy"

## Monitor in Production

Check logs regularly:
1. Click your service in Railway
2. Click "View Logs"
3. Filter by:
   - Error logs (red text)
   - Bot activity
   - API requests

## Security Best Practices

1. âœ… Never commit secrets to GitHub
2. âœ… Use Railway Variables for secrets
3. âœ… Set `NODE_ENV=production`
4. âœ… Keep database URL secret
5. âœ… Monitor error logs
6. âœ… Use HTTPS only (Railway provides this)

## Custom Domain (Optional)

To use a custom domain:
1. Go to your service's "Domains"
2. Click "Add Domain"
3. Enter your domain
4. Follow DNS instructions
5. Wait for DNS propagation (~24h)

## Cost Estimation

- Railway free tier: ~$5/month included
- PostgreSQL: ~$7/month (Railway pricing)
- Total: ~$12-15/month for production

## Next Steps

1. âœ… Set up admin panel (optional)
2. âœ… Configure Telegram bot webhooks (optional, polling works fine)
3. âœ… Set up error monitoring (Sentry)
4. âœ… Configure CI/CD (GitHub Actions)

## Support

For Railway issues: https://railway.app/support
For Telegram Bot API: https://core.telegram.org/bots/api

---

**Deployment Status**: Ready for production âœ…
